{"version":3,"sources":["../src/fetchIRStrategy.ts","../src/types.ts","../src/renderer/reserve.ts","../src/utils/diff.ts","../src/diffReports.ts"],"sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nimport { Readable } from \"stream\";\nimport { finished } from \"stream/promises\";\n\n/**\n * Fetches the rate image from rate-strategy explorer\n * @dev currently broken as https://github.com/foundry-rs/foundry/issues/4601 results in json numbers which will be broken inside js\n * @param {*} rate\n * @param fileName the fileName to store the ir to\n */\nexport async function fetchRateStrategyImage(rate, fileName) {\n  const relativePath = path.join(process.cwd(), \".assets\");\n  const pathWithFile = path.join(relativePath, `${fileName}.svg`);\n  // skip in case file already exists\n  if (fs.existsSync(pathWithFile)) return;\n  // create folder if it doesn't exist\n  if (!fs.existsSync(relativePath)) {\n    fs.mkdirSync(relativePath, { recursive: true });\n  }\n  const paramsObj = {\n    variableRateSlope1: rate.variableRateSlope1,\n    variableRateSlope2: rate.variableRateSlope2,\n    stableRateSlope1: rate.stableRateSlope1,\n    stableRateSlope2: rate.stableRateSlope2,\n    optimalUsageRatio: rate.optimalUsageRatio,\n    baseVariableBorrowRate: rate.baseVariableBorrowRate,\n    baseStableBorrowRate: rate.baseStableBorrowRate,\n  };\n  const searchParams = new URLSearchParams(paramsObj);\n  const { body } = await fetch(\n    `https://rate-strategy-explorer.vercel.app/api/static?${searchParams.toString()}`\n  );\n  const fileStream = fs.createWriteStream(pathWithFile);\n  if (!body) throw Error(\"Error fetchign the image\");\n  // any cast due to some mismatch on ReadableStream node vs web\n  await finished(Readable.fromWeb(body as any).pipe(fileStream));\n}\n","import { z } from \"zod\";\n\nexport const aaveV3ConfigSchema = z.object({\n  oracle: z.string(),\n  pool: z.string(),\n  poolAddressesProvider: z.string(),\n  poolConfigurator: z.string(),\n  poolConfiguratorImpl: z.string(),\n  poolImpl: z.string(),\n  protocolDataProvider: z.string(),\n});\n\nexport type AaveV3Config = z.infer<typeof aaveV3ConfigSchema>;\n\nexport const aaveV3ReserveSchema = z.object({\n  isBorrowableInIsolation: z.boolean(),\n  borrowCap: z.number(),\n  liquidationBonus: z.number(),\n  underlying: z.string(),\n  isFrozen: z.boolean(),\n  stableDebtToken: z.string(),\n  variableDebtToken: z.string(),\n  reserveFactor: z.number(),\n  liquidationProtocolFee: z.number(),\n  usageAsCollateralEnabled: z.boolean(),\n  ltv: z.number(),\n  supplyCap: z.number(),\n  debtCeiling: z.number(),\n  borrowingEnabled: z.boolean(),\n  isActive: z.boolean(),\n  eModeCategory: z.number(),\n  symbol: z.string(),\n  stableBorrowRateEnabled: z.boolean(),\n  isFlashloanable: z.boolean(),\n  aToken: z.string(),\n  liquidationThreshold: z.number(),\n  aTokenImpl: z.string(),\n  stableDebtTokenImpl: z.string(),\n  interestRateStrategy: z.string(),\n  variableDebtTokenImpl: z.string(),\n  oracleLatestAnswer: z.number(),\n  oracle: z.string(),\n  decimals: z.number(),\n  isSiloed: z.boolean(),\n});\n\nexport type AaveV3Reserve = z.infer<typeof aaveV3ReserveSchema>;\n\nexport const aaveV3StrategySchema = z.object({\n  baseStableBorrowRate: z.number(),\n  maxExcessStableToTotalDebtRatio: z.number(),\n  address: z.string(),\n  baseVariableBorrowRate: z.number(),\n  stableRateSlope2: z.number(),\n  optimalUsageRatio: z.number(),\n  variableRateSlope2: z.number(),\n  optimalStableToTotalDebtRatio: z.number(),\n  maxExcessUsageRatio: z.number(),\n  stableRateSlope1: z.number(),\n  variableRateSlope1: z.number(),\n});\n\nexport type AaveV3Strategy = z.infer<typeof aaveV3StrategySchema>;\n\nexport const aaveV3EmodeSchema = z.object({\n  eModeCategory: z.number(),\n  liquidationBonus: z.number(),\n  label: z.string(),\n  liquidationThreshold: z.number(),\n  priceSource: z.string(),\n  ltv: z.number(),\n});\n\nexport type AaveV3Emode = z.infer<typeof aaveV3EmodeSchema>;\n\nexport const CHAIN_ID = {\n  MAINNET: 1,\n  OPTIMISM: 10,\n  POLYGON: 137,\n  FANTOM: 250,\n  ARBITRUM: 42161,\n  AVALANCHE: 43114,\n} as const;\n\nconst zodChainId = z.nativeEnum(CHAIN_ID);\n\nexport type CHAIN_ID = z.infer<typeof zodChainId>;\n\nexport const aaveV3SnapshotSchema = z.object({\n  reserves: z.record(aaveV3ReserveSchema),\n  strategies: z.record(aaveV3StrategySchema),\n  eModes: z.record(aaveV3EmodeSchema),\n  poolConfig: aaveV3ConfigSchema,\n  chainId: zodChainId,\n});\n\nexport type AaveV3Snapshot = z.infer<typeof aaveV3SnapshotSchema>;\n","import { fetchRateStrategyImage } from \"../fetchIRStrategy\";\nimport { AaveV3Reserve, CHAIN_ID } from \"../types\";\n\nexport const getBlockExplorerLink: {\n  [key in CHAIN_ID]: (address: string) => string;\n} = {\n  [CHAIN_ID.MAINNET]: (address) =>\n    `[${address}](https://etherscan.io/address/${address})`,\n  [CHAIN_ID.OPTIMISM]: (address) =>\n    `[${address}](https://optimistic.etherscan.io/address/${address})`,\n  [CHAIN_ID.POLYGON]: (address) =>\n    `[${address}](https://polygonscan.com/address/${address})`,\n  [CHAIN_ID.FANTOM]: (address) =>\n    `[${address}](https://ftmscan.com/address/${address})`,\n  [CHAIN_ID.ARBITRUM]: (address) =>\n    `[${address}](https://https://arbiscan.io/address/${address})`,\n  [CHAIN_ID.AVALANCHE]: (address) =>\n    `[${address}](https://snowtrace.io/address/${address})`,\n};\n\nexport function renderValue<T extends keyof AaveV3Reserve>(\n  key: T,\n  reserve: AaveV3Reserve,\n  chainId: CHAIN_ID\n) {\n  if (\n    [\n      \"reserveFactor\",\n      \"liquidationProtocolFee\",\n      \"liquidationThreshold\",\n      \"ltv\",\n    ].includes(key)\n  )\n    return `${(reserve[key] as number) / 100} %`;\n  if ([\"supplyCap\", \"borrowCap\"].includes(key))\n    return `${reserve[key].toLocaleString(\"en-US\")} ${reserve.symbol}`;\n  if (key === \"liquidationBonus\")\n    return `${((reserve[key] as number) - 10000) / 100} %`;\n  if (key === \"interestRateStrategy\")\n    return `![${getBlockExplorerLink[chainId](\n      reserve[key] as string\n    )}](/assets/${chainId}_${reserve[key]}.svg)`;\n  if (typeof reserve[key] === \"number\")\n    return reserve[key].toLocaleString(\"en-US\");\n  if (typeof reserve[key] === \"string\" && /0x.+/.test(reserve[key] as string))\n    return getBlockExplorerLink[chainId](reserve[key] as string);\n  return reserve[key];\n}\n\nfunction renderReserveHeadline(reserve: AaveV3Reserve, chainId: CHAIN_ID) {\n  return `#### ${reserve.symbol} (${getBlockExplorerLink[chainId](\n    reserve.underlying\n  )})\\n\\n`;\n}\n\nconst ORDER: (keyof AaveV3Reserve)[] = [\"supplyCap\", \"borrowCap\"];\nfunction sortReserveKeys(a: keyof AaveV3Reserve, b: keyof AaveV3Reserve) {\n  const indexA = ORDER.indexOf(a);\n  const indexB = ORDER.indexOf(b);\n  if (indexA != -1 && indexB != -1) {\n    if (indexA > indexB) {\n      return 1;\n    }\n    if (indexB > indexA) {\n      return -1;\n    }\n  }\n  if (indexA != -1) return -1;\n  if (indexB != -1) return -1;\n  return a.localeCompare(b);\n}\n\nfunction renderReserveConfig(reserve: AaveV3Reserve, chainId: CHAIN_ID) {\n  let content = \"| description | value |\\n| --- | --- |\\n\";\n  const OMIT_KEYS: (keyof AaveV3Reserve)[] = [\n    \"underlying\", // already rendered in the header\n    \"symbol\", // already rendered in the header\n  ];\n  (Object.keys(reserve) as (keyof AaveV3Reserve)[])\n    .filter((key) => !OMIT_KEYS.includes(key))\n    .sort(sortReserveKeys)\n    .map((key) => {\n      content += `| ${key} | ${renderValue(key, reserve, chainId)} |\\n`;\n    });\n  return content;\n}\n\nexport type ReserveConfigDiff<A extends AaveV3Reserve = AaveV3Reserve> = {\n  [key in keyof A]: A[key] & { from: A[key] | null; to: A[key] | null };\n};\n\nfunction renderReserveConfigDiff(\n  reserve: ReserveConfigDiff,\n  chainId: CHAIN_ID\n) {\n  let content =\n    \"| description | value before | value after |\\n| --- | --- | --- |\\n\";\n  (Object.keys(reserve) as (keyof AaveV3Reserve)[])\n    .filter((key) => reserve[key].from)\n    .sort(sortReserveKeys)\n    .map((key) => {\n      content += `| ${key} | ${renderValue(\n        key,\n        { ...reserve, [key]: reserve[key].from },\n        chainId\n      )} | ${renderValue(\n        key,\n        { ...reserve, [key]: reserve[key].to },\n        chainId\n      )} |\\n`;\n    });\n  return content;\n}\n\nexport function renderReserve(reserve: AaveV3Reserve, chainId: CHAIN_ID) {\n  let content = renderReserveHeadline(reserve, chainId);\n  content += renderReserveConfig(reserve, chainId);\n  return content;\n}\n\nexport function renderReserveDiff(diff: ReserveConfigDiff, chainId: CHAIN_ID) {\n  let content = renderReserveHeadline(diff as AaveV3Reserve, chainId);\n  content += renderReserveConfigDiff(diff, chainId);\n  return content;\n}\n","/**\n * Highly inspired by - reimplemented a bit simpler & added types\n * @license MIT https://github.com/omgaz/diffler\n * Author: Gary Chisholm @omgaz\n */\n\nexport type Difference<\n  A extends Record<string, any>,\n  B extends Record<string, any>\n> = { [key in keyof Omit<A, keyof B>]: { from: A[key]; to: null } } & {\n  [key in keyof Omit<B, keyof A>]: { from: null; to: B[key] };\n};\n\nexport type DiffOutput<\n  A extends Record<string, any>,\n  B extends Record<string, any>\n> = {\n  [key in keyof (A | B)]: DiffOutput<A[key], B[key]>;\n} & Difference<A, B>;\n\nexport function diff<\n  T extends Record<string, any>,\n  X extends Record<string, any>\n>(a: T, b: X, removeUnchanged?: boolean): DiffOutput<T, X> {\n  const out = {} as Record<string, any>;\n  for (const key in a) {\n    if (!b.hasOwnProperty(key)) {\n      out[key] = { from: a[key], to: null };\n    } else {\n      if (typeof a[key] === \"object\") {\n        const tempDiff = diff(a[key], b[key], removeUnchanged);\n        if (Object.keys(tempDiff).length > 0) {\n          out[key] = tempDiff;\n        }\n      } else {\n        if (b[key as string] == a[key]) {\n          if (!removeUnchanged) out[key] = a[key];\n        } else {\n          out[key] = { from: a[key], to: b[key] };\n        }\n      }\n    }\n  }\n  for (const key in b) {\n    if (a.hasOwnProperty(key)) continue;\n    out[key] = { from: null, to: b[key] };\n  }\n  return out as DiffOutput<T, X>;\n}\n","import { fetchRateStrategyImage } from \"./fetchIRStrategy\";\nimport { renderReserve, renderReserveDiff } from \"./renderer/reserve\";\nimport { AaveV3Snapshot } from \"./types\";\nimport { diff } from \"./utils/diff\";\n\nexport async function diffReports<\n  A extends AaveV3Snapshot,\n  B extends AaveV3Snapshot\n>(pre: A, post: B) {\n  const chainId = pre.chainId;\n  const diffResult = diff(pre, post);\n  // download interest rate strategies\n  // only downloads if it doesn't exist yet\n  for (const ir in pre.strategies) {\n    await fetchRateStrategyImage(pre.strategies[ir], `${chainId}_${ir}`);\n  }\n  for (const ir in post.strategies) {\n    await fetchRateStrategyImage(post.strategies[ir], `${chainId}_${ir}`);\n  }\n\n  // create report\n  let content = \"\";\n  const reservesAdded = Object.keys(diffResult.reserves)\n    .map((reserveKey) => {\n      // to being present on reserve level % trueish means reserve was added\n      if ((diffResult.reserves[reserveKey] as any).to) {\n        return renderReserve(\n          (diffResult.reserves[reserveKey] as any).to,\n          chainId\n        );\n      }\n    })\n    .filter((i) => i);\n  const reservesRemoved = Object.keys(diffResult.reserves)\n    .map((reserveKey) => {\n      // from being present on reserve level % trueish means reserve was removed\n      if ((diffResult.reserves[reserveKey] as any).from) {\n        return renderReserve(\n          (diffResult.reserves[reserveKey] as any).from,\n          chainId\n        );\n      }\n    })\n    .filter((i) => i);\n  const reservesAltered = Object.keys(diffResult.reserves)\n    .map((reserveKey) => {\n      // from being present on key means reserve was removed\n      if (\n        !(diffResult.reserves[reserveKey] as any).hasOwnProperty(\"from\") &&\n        Object.keys(diffResult.reserves[reserveKey]).find(\n          (fieldKey) =>\n            typeof diffResult.reserves[reserveKey][fieldKey] === \"object\"\n        )\n      ) {\n        console.log(diffResult.reserves[reserveKey]);\n        return renderReserveDiff(\n          diffResult.reserves[reserveKey] as any,\n          chainId\n        );\n      }\n    })\n    .filter((i) => i);\n  if (\n    reservesAdded.length ||\n    reservesRemoved.length ||\n    reservesAltered.length\n  ) {\n    content += \"## Reserve changes\\n\\n\";\n    if (reservesAdded.length) {\n      content += `### ${\n        reservesAdded.length > 1 ? \"Reserve\" : \"Reserves\"\n      } added\\n\\n`;\n      content += reservesAdded.join(\"\\n\\n\");\n      content += \"\\n\\n\";\n    }\n\n    if (reservesAltered.length) {\n      content += `### ${\n        reservesAltered.length > 1 ? \"Reserve\" : \"Reserves\"\n      } altered\\n\\n`;\n      content += reservesAltered.join(\"\\n\\n\");\n      content += \"\\n\\n\";\n    }\n\n    if (reservesRemoved.length) {\n      content += `### ${\n        reservesRemoved.length > 1 ? \"Reserve\" : \"Reserves\"\n      } removed\\n\\n`;\n      content += reservesRemoved.join(\"\\n\\n\");\n      content += \"\\n\\n\";\n    }\n  }\n\n  content += `## Raw diff\\n\\n\\`\\`\\`json\\n${JSON.stringify(\n    diff(pre, post, true),\n    null,\n    2\n  )}\\n\\`\\`\\``;\n  return content;\n}\n"],"mappings":"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","names":["diff"]}