{"version":3,"sources":["../src/renderer/reserves.ts","../src/utils/diffler.ts","../src/diffReports.ts"],"sourcesContent":["import { DiffedInput, AaveV3Reserve } from \"../types\";\n\nexport function renderReserves(reserves: DiffedInput<AaveV3Reserve>): string {\n  const { added, removed, altered } = Object.entries(reserves)\n    .sort(([keyA], [keyB]) => {\n      return keyA.localeCompare(keyB, \"en-US\");\n    })\n    .reduce(\n      (acc, [key, value]) => {\n        if (value.from) {\n          acc.removed.push(value.from);\n        } else if (value.to) {\n          acc.added.push(value.to);\n        } else {\n          acc.altered.push(value);\n        }\n        return acc;\n      },\n      {\n        added: [] as AaveV3Reserve[],\n        removed: [] as AaveV3Reserve[],\n        altered: [] as {\n          [K in keyof AaveV3Reserve]?: {\n            from: AaveV3Reserve[K];\n            to: AaveV3Reserve[K];\n          };\n        }[],\n      }\n    );\n  if (!altered.length && !added.length && !removed.length) return \"\";\n  let content = \"\";\n  content += `## Reserves\\n\\n`;\n\n  if (altered.length) {\n    content += `### Reserve altered\\n\\n`;\n    for (const reserve of altered) {\n      content += `| key | value |\\n`;\n      content += `| --- | --- |\\n`;\n      Object.keys(reserve).map((key) => {\n        content += `| ${key} | ~~${reserve[key].from}~~${reserve[key].to} |\\n`;\n      });\n      content += `\\n\\n`;\n    }\n  }\n\n  if (added.length) {\n    content += `### Reserve added\\n\\n`;\n    for (const reserve of added) {\n      content += `| key | value |\\n`;\n      content += `| --- | --- |\\n`;\n      Object.keys(reserve).map((key) => {\n        content += `| ${key} | ${reserve[key]} |\\n`;\n      });\n      content += `\\n\\n`;\n    }\n  }\n\n  if (removed.length) {\n    content += `### Reserve added\\n\\n`;\n    for (const reserve of removed) {\n      content += `| key | value |\\n`;\n      content += `| --- | --- |\\n`;\n      Object.keys(reserve).map((key) => {\n        content += `| ${key} | ${reserve[key]} |\\n`;\n      });\n      content += `\\n\\n`;\n    }\n  }\n  return content;\n}\n","/**\n * @dev this is a modified version of the `diffler` npm package.\n * The modification adds exact types.\n * @license MIT https://github.com/omgaz/diffler\n * Author: Gary Chisholm @omgaz\n */\n\ntype SimpleJSONValue = string | number | boolean;\n\ntype OutType<A, B> = A extends SimpleJSONValue\n  ? Readonly<A> extends Readonly<B>\n    ? never\n    : { from: A; to: B }\n  : {\n      // intersecting properties\n      [K in keyof (A | B)]: Readonly<A[K]> extends Readonly<B[K]>\n        ? never\n        : OutType<Readonly<A[K]>, Readonly<B[K]>>;\n    } & {\n      // non intersecting properties only on A\n      [Y in keyof Omit<A, keyof B>]: { from: A[Y]; to: null };\n    } & {\n      // non intersecting properties only on B\n      [Z in keyof Omit<B, keyof A>]: { from: null; to: B[Z] };\n    };\n\nexport function diffler<\n  A extends Readonly<Record<string, unknown>>,\n  B extends Readonly<Record<string, unknown>>\n>(obj1: Readonly<A>, obj2: Readonly<B>): OutType<Readonly<A>, Readonly<B>> {\n  let diff = {} as OutType<Readonly<A>, Readonly<B>>;\n\n  // Iterate over obj1 looking for removals and differences in existing values\n  for (const key in obj1) {\n    if (obj1.hasOwnProperty(key) && typeof obj1[key] !== \"function\") {\n      const obj1Val = obj1[key];\n      const obj2Val = obj2[key];\n\n      if (typeof obj1Val !== typeof obj2Val) {\n        diff[key as string] = {\n          from: obj1Val,\n          to: obj2Val,\n        };\n        break;\n      }\n\n      // If property exists in obj1 and not in obj2 then it has been removed\n      if (!(key in obj2)) {\n        diff[key as string] = {\n          from: obj1Val,\n          to: null, // using null to specify that the value is empty in obj2\n        };\n      }\n\n      // If property is an object then we need to recursively go down the rabbit hole\n      else if (typeof obj1Val === \"object\") {\n        var tempDiff = diffler(\n          obj1Val as Record<string, unknown>,\n          obj2Val as Record<string, unknown>\n        );\n        if (Object.keys(tempDiff).length > 0) {\n          if (tempDiff) {\n            diff[key as string] = tempDiff;\n          }\n        }\n      }\n\n      // If property is in both obj1 and obj2 and is different\n      else if ((obj1Val as string) !== (obj2Val as string)) {\n        diff[key as string] = {\n          from: obj1Val,\n          to: obj2Val,\n        };\n      }\n    }\n  }\n\n  // Iterate over obj2 looking for any new additions\n  for (const key in obj2) {\n    if (obj2.hasOwnProperty(key) && typeof obj2[key] !== \"function\") {\n      if (obj1 === null) {\n        diff[key as string] = {\n          from: obj1,\n          to: obj2[key],\n        };\n        break;\n      }\n\n      const obj2Val = obj2[key];\n\n      if (!(key in obj1)) {\n        if (!diff) {\n          (diff as unknown) = {};\n        }\n        diff[key as string] = {\n          from: null,\n          to: obj2Val,\n        };\n      }\n    }\n  }\n\n  return diff as OutType<Readonly<A>, Readonly<B>>;\n}\n","import { renderReserves } from \"./renderer/reserves\";\nimport { AaveV3Snapshot } from \"./types\";\nimport { diffler } from \"./utils/diffler\";\n\nexport function diffReports<A extends AaveV3Snapshot, B extends AaveV3Snapshot>(\n  pre: A,\n  post: B\n) {\n  const diff = diffler(pre, post);\n  let content = renderReserves(diff.reserves);\n\n  content += `### Raw diff\\n\\n\\`\\`\\`json\\n${JSON.stringify(\n    diff,\n    null,\n    2\n  )}\\n\\`\\`\\``;\n  return content;\n}\n"],"mappings":"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","names":[]}